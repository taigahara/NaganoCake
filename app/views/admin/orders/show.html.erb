<h2>注文詳細画面</h2>

<table>
  <tr>
    <th>購入者</th>
    <th><%= @order.end_user.last_name %><%= @order.end_user.first_name %></th>
  </tr>
  <tr>
    <th>配送先</th>
    <th>
      <%= @order.postal_code %>
      <%= @order.address %>
    </th>
  </tr>
  <tr>
    <th>支払方法</th>
    <th><%= @order.payment_method %></th>
  </tr>
  <tr>
    <th>注文ステータス</th>
     <th><%= form_with model:@order, url: admin_order_path(@order), local: true do |f| %></th>
     <th><%= f.select :status, Order.statuses.keys.map { |k| [I18n.t("enums.order.status.#{k}"),k]} %></th>
     <th><%= f.submit "更新" %></th>
    <% end %>
  </tr>
  <table>
               <tr>
          　　　　　　<td>商品名</td>
          　　　　　　<td>税込価格</td>
                    <td>個数</td>
                    <td>小計</td>
                    <td>制作ステータス</td>
          　　　</tr>
          <% @sum = 0 %>
        <div>
          　<% @order_details.each do |order| %>
                <tr>
                    <th><%= order.product.name %></th>
                    <th><%= (order.product.price * 1.1).round %>円</th>
                    <th><%= order.quantity %>個</th>
                    <th><%= (order.product.price * 1.1).round.to_i * order.quantity.to_i %>円</th>
                    <% @sum += (order.product.price * 1.1).round.to_i * order.quantity.to_i %>
                    <td>
                    <%= form_with model:order, url: admin_order_detail_path(order), method: :patch, local: true do |f| %>
                      <th><%= f.select :production_status, OrderDetail.production_statuses.keys.map { |k| [I18n.t("enums.order_detail.production_status.#{k}"),k] } %></th>
                      <th><%= f.submit "更新"%></th>
                    <% end %>
                    </td>
                </tr>
           <% end %>
        </div>
    </table>

<div>
  <p>商品合計: <%= @sum %></p>
  <p>送料：800円</p>
  <p>請求金額合計: <%= @sum.to_i + 800 %></p>
</div>

